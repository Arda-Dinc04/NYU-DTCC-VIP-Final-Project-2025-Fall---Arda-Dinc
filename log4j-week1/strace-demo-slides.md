# Using `strace` to Prove Dynamic Log4j Loading

## Slide 1: The Problem

- **Static SBOMs** miss dynamically loaded libraries
- **Dynamic SBOMs** (like Syft) can catch them
- But how do we **prove** dynamic loading happened?
- **Answer:** System call tracing with `strace`

---

## Slide 2: What is `strace`?

- **System call tracer** for Linux/Unix
- Intercepts and records all system calls made by a process
- Shows file operations, network calls, memory operations
- **Key insight:** File open operations reveal library loading

---

## Slide 3: Why `strace` for Dynamic Loading?

- Java loads classes at runtime via `ClassLoader`
- Loading a JAR file requires **opening the file**
- `strace` captures these `open()` / `openat()` calls
- **Proof:** See JAR files being opened at runtime!

---

## Slide 4: Our Demo Setup

### Static Demo (`log4j-static-demo`)

- Log4j in `pom.xml` dependencies
- Loaded from Maven cache or bundled
- **SBOM shows:** Log4j in components

### Dynamic Demo (`log4j-dynamic-demo`)

- **NO** Log4j in `pom.xml`
- JARs loaded from `runtime-libs/` at runtime
- Uses `URLClassLoader` + reflection
- **SBOM shows:** Log4j discovered via Syft

---

## Slide 5: The Command

```bash
strace -e trace=open,openat -f -s 200 \
    java -cp target/app.jar com.example.App
```

**Flags:**

- `-e trace=open,openat` - Only show file open operations
- `-f` - Follow child processes (Java spawns threads)
- `-s 200` - Show 200 chars of string arguments
- `-o file.log` - Save to file

---

## Slide 6: What We're Looking For

### Key System Call:

```
openat(AT_FDCWD, "runtime-libs/log4j-core-2.25.2.jar", ...)
```

### Interpretation:

- **File path** reveals where JAR is loaded from
- **Timing** shows it happens at runtime (not compile-time)
- **Multiple opens** for different JARs (api, core)

---

## Slide 7: Static Loading Trace

```
openat(AT_FDCWD, "/home/user/.m2/repository/org/apache/logging/log4j/log4j-core/2.25.2/log4j-core-2.25.2.jar", ...)
```

**Observation:**

- JARs from Maven repository
- Loaded as part of classpath
- Expected in static SBOM

---

## Slide 8: Dynamic Loading Trace

```
openat(AT_FDCWD, "runtime-libs/log4j-api-2.25.2.jar", O_RDONLY|O_CLOEXEC) = 15
openat(AT_FDCWD, "runtime-libs/log4j-core-2.25.2.jar", O_RDONLY|O_CLOEXEC) = 16
```

**Observation:**

- JARs from `runtime-libs/` directory
- **NOT** in Maven dependencies
- **Proves** runtime dynamic loading!
- **Matches** what Syft found in dynamic SBOM

---

## Slide 9: SBOM Comparison

### Static SBOM (`bom.json`)

```json
{
  "components": [
    {
      "name": "log4j-core",
      "version": "2.25.2",
      "purl": "pkg:maven/org.apache.logging.log4j/log4j-core@2.25.2"
    }
  ]
}
```

- Generated by **CycloneDX Maven plugin**
- Based on `pom.xml` dependencies

### Dynamic SBOM (`sbom-dynamic.json`)

```json
{
  "components": [
    {
      "name": "log4j-core",
      "version": "2.25.2",
      "properties": [
        { "name": "syft:location:0:path", "value": "/log4j-core-2.25.2.jar" }
      ]
    }
  ]
}
```

- Generated by **Syft**
- Scanned `runtime-libs/` directory
- **Matches** what `strace` shows!

---

## Slide 10: Key Takeaways

1. **`strace` proves dynamic loading** by showing file operations
2. **System calls don't lie** - they show actual runtime behavior
3. **Static SBOMs can miss** dynamically loaded libraries
4. **Dynamic SBOMs + `strace`** provide complete picture
5. **Security implication:** Need both to find all dependencies

---

## Slide 11: Real-World Use Cases

- **Vulnerability scanning:** Find all loaded libraries
- **Compliance:** Prove what runs in production
- **Forensics:** Investigate unexpected library loading
- **Security audits:** Verify no hidden dependencies

---

## Slide 12: Demo Instructions

```bash
cd log4j-week1
./demo-strace.sh
```

**What it does:**

1. Builds both demo projects
2. Runs each with `strace`
3. Shows file operations for comparison
4. Highlights the difference

**Try it yourself!**

---

## Slide 13: Summary

- ✅ **`strace`** reveals system calls
- ✅ **File opens** show library loading
- ✅ **Dynamic loading** visible in traces
- ✅ **Matches** dynamic SBOM findings
- ✅ **Proves** what actually runs

**Static analysis ≠ Runtime reality**

---

## Slide 14: Questions?

**Resources:**

- `strace` man page: `man strace`
- Demo script: `demo-strace.sh`
- SBOMs: `bom.json` (static), `sbom-dynamic.json` (dynamic)

**Next Steps:**

- Try the demo yourself
- Experiment with different `strace` filters
- Compare with other tracing tools (`dtrace`, `ltrace`)


